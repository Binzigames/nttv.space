<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>NTTV ‚Äì –ü—ñ–¥–ø–∏—Å–∫–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='profile_subs.css') }}">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1119387653458763"
         crossorigin="anonymous"></script>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>
<body>
    <div class="subscriptions-container">
        <div class="page-header">
            <h1 class="page-title">üì∫ NTTV –ü—ñ–¥–ø–∏—Å–∫–∏</h1>
            <p class="page-subtitle">NextTheme.TV ‚Äì –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ç–µ–º, —Ç–≤–æ—Ä—á–æ—Å—Ç—ñ —Ç–∞ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è</p>
            
            <div class="header-nav">
                <a href="{{ url_for('forums') }}" class="nav-link">üéØ –¢–µ–º–∏</a>
                <a href="{{ url_for('profile') }}" class="nav-link">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</a>
                <a href="{{ url_for('index') }}" class="nav-link">üè† –ì–æ–ª–æ–≤–Ω–∞</a>
            </div>
        </div>

        <div class="forum-list">
            {% if subs %}
                {% for forum_id, forum in subs.items() %}
                    <div class="forum-card">
                        <h3 class="forum-title">{{ forum['name'] }}</h3>
                        
                        <div class="forum-stats">
                            <div class="stat-item">
                                <div class="stat-label">–ü—ñ–¥–ø–∏—Å–Ω–∏–∫–∏</div>
                                <div class="stat-value">{{ get_subscriber_count(forum_id) }}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">–†–µ–ø—É—Ç–∞—Ü—ñ—è</div>
                                <div class="stat-value">{{ forum['reputation'] }}</div>
                            </div>
                        </div>

                        <p class="forum-description">{{ forum['description'] }}</p>
                        
                        <div class="forum-author">
                            <strong>–ê–≤—Ç–æ—Ä:</strong>
                            {% set author = users.get(forum['author_id']) %}
                            {{ author['username'] if author else '–ù–µ–≤—ñ–¥–æ–º–∏–π' }}
                        </div>

                        <div class="forum-actions">
                            <a href="{{ url_for('view_forum', forum_id=forum_id) }}" class="action-button">
                                üîç –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏
                            </a>

                            {% if 'user_id' in session %}
                                {% if session['user_id'] not in forum['subscribers'] %}
                                    <form action="/forums/subscribe/{{ forum_id }}" method="POST" style="display: inline;">
                                        <button type="submit" class="action-button success">
                                            ‚ûï –ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è
                                        </button>
                                    </form>
                                {% else %}
                                    <form action="/forums/unsubscribe/{{ forum_id }}" method="POST" style="display: inline;">
                                        <button type="submit" class="action-button danger">
                                            ‚ûñ –í—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è
                                        </button>
                                    </form>
                                {% endif %}

                                {% if session['user_id'] == forum['author_id'] %}
                                    <form action="/forums/moderate/{{ forum_id }}" method="GET" style="display: inline;">
                                        <button type="submit" class="action-button warning">
                                            ‚öôÔ∏è –ö–µ—Ä—É–≤–∞—Ç–∏
                                        </button>
                                    </form>
                                {% endif %}
                            {% else %}
                                <p class="login-prompt">
                                    –î–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ <a href="{{ url_for('login') }}">—É–≤—ñ–π—Ç–∏</a>
                                </p>
                            {% endif %}
                        </div>

                        {% if show_menu == forum_id %}
                            <div class="admin-menu">
                                {% if session['user_id'] == forum['author_id'] or 'admin' in session.get('roles', []) %}
                                    <form action="/forums/delete/{{ forum_id }}" method="POST" 
                                          onsubmit="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ñ–æ—Ä—É–º?')" 
                                          style="display: inline;">
                                        <button type="submit" class="action-button danger">
                                            üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ —Ç–µ–º—É
                                        </button>
                                    </form>
                                    <form action="/forums/edit/{{ forum_id }}" method="GET" style="display: inline;">
                                        <button type="submit" class="action-button">
                                            ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <p>–í–∏ —â–µ –Ω–µ –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ –Ω–∞ –∂–æ–¥–µ–Ω —Ñ–æ—Ä—É–º.</p>
                    <p class="subtitle">–°–∞–º–µ —á–∞—Å —Ü–µ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏...</p>
                    <a href="{{ url_for('forums') }}" class="action-button success" style="margin-top: 1rem;">
                        üöÄ –ó–Ω–∞–π—Ç–∏ —Ç–µ–º–∏
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html>
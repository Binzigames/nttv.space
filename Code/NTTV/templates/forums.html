<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTTV ‚Äì –¢–µ–º–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1119387653458763"
     crossorigin="anonymous"></script>
     <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
     <style>
  div[style*="width: 300px"] {
    background-color: var(--color-surface);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  div[style*="border: 3px solid darkred"] {
    border-color: var(--color-accent);
    background-color: #1a1a1a;
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
  }

  div[style*="border: 3px solid darkred"] h2 {
    color: var(--color-accent);
    font-weight: 700;
    margin-bottom: 12px;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  form label {
    font-weight: 600;
    color: var(--color-primary);
  }

  form input[type="text"] {
    background-color: var(--color-surface);
    border: 1px solid var(--color-accent);
    padding: 10px;
    border-radius: var(--radius);
    color: var(--color-primary);
    transition: border-color 0.3s ease;
  }

  form input[type="text"]:focus {
    border-color: var(--color-primary);
    outline: none;
    box-shadow: 0 0 6px var(--color-accent);
  }

  form button {
    background-color: var(--color-accent);
    color: var(--color-bg);
    border: none;
    padding: 12px;
    font-weight: 700;
    border-radius: var(--radius);
    cursor: pointer;
    transition: background-color 0.3s ease;
    text-transform: uppercase;
  }

  form button:hover {
    background-color: var(--color-primary);
  }

  .admin-menu {
    margin-top: 10px;
    display: flex;
    gap: 12px;
  }

  .admin-menu form button {
    padding: 8px 16px;
    font-weight: 600;
    border-radius: var(--radius);
    cursor: pointer;
    border: 1px solid var(--color-accent);
    background: transparent;
    color: var(--color-accent);
    transition: background-color 0.3s ease;
  }

  .admin-menu form button:hover {
    background-color: var(--color-accent);
    color: var(--color-bg);
  }
.main-layout {
  display: flex;
  gap: 20px;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  box-sizing: border-box;
  align-items: flex-start; 
}

.sidebar {
  flex: 0 0 300px; 
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.forum-list {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 15px;
}
@media (max-width: 768px) {
  .main-layout {
    flex-direction: column;
    padding: 10px;
  }

  .sidebar {
    flex: 1;
    width: 100%;
  }

  .forum-list {
    width: 100%;
  }

  nav {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  header h1 {
    font-size: 1.5rem;
  }

  .card {
    padding: 12px;
  }

  form input[type="text"], form button {
    width: 100%;
  }

  .admin-menu {
    flex-direction: column;
    gap: 8px;
  }
}


</style>
</head>
<body>
<header>
    <h1> NTTV</h1>
    <p class="subtitle_s">NextTheme.TV ‚Äì –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ç–µ–º, —Ç–≤–æ—Ä—á–æ—Å—Ç—ñ —Ç–∞ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è</p>
    <nav>
        <a href="profile">–ø—Ä–æ—Ñ—ñ–ª—å</a>
        <a href="profile_subs">–ü—ñ–¥–ø–∏—Å–∫–∏</a>
        <a href="/">–≥–æ–ª–æ–≤–Ω–∞</a>
    </nav>
</header>
<main class="main-layout">
    <div class="sidebar">
        <div class="card create-forum-card">
            {% if 'user_id' in session %}
                <section class="create-forum">
                    <h2>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ–º</h2>
                    <form action="{{ url_for('forums') }}" method="POST">
                        <label for="forum_name">–ù–∞–∑–≤–∞ –¢–µ–º–∏:</label>
                        <input type="text" id="forum_name" name="forum_name" required />
                        <label for="forum_description">–û–ø–∏—Å –¢–µ–º–∏:</label>
                        <input type="text" id="forum_description" name="forum_description" required />
                        <button type="submit">–°—Ç–≤–æ—Ä–∏—Ç–∏ –¢–µ–º–∏</button>
                    </form>
                </section>
                <p class="subtitle_s">–≤–∞–≥–∞—î—Ç–µ—Å—è —á–∏ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ç–µ–º—É? —á–∏ —î –∑–∞–ø–∏—Ç–∞–Ω–Ω—è? –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –¥–æ –Ω–∞—à–æ–≥–æ :</p>
                <p class="subtitle"><a href="https://docs.google.com/document/d/1D3_-t8Nhd7-MKiRnXctxgexI1nBVyEr6cAERzAXqoIg/edit?usp=sharing">–î–æ–∫—É–º–µ–Ω—Ç—É</a></p>
            {% else %}
                <p>–î–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¢–µ–º–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ <a href="{{ url_for('login') }}">—É–≤—ñ–π—Ç–∏</a>.</p>
            {% endif %}
        </div>

        <div class="card live-forums">
            <h2>–¢–µ–º–∏ - –í –µ—Ç–µ—Ä—ñ</h2>
            <p class="subtitle_s">–°–≤—ñ—Ç–∏ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –Ω–∞–∂–∏–≤–æ —á–µ–∫–∞—é—Ç—å –Ω–∞ –≤–∞—Å!</p>
            <ul>
                {% for forum_id, forum in forums if forum.is_live %}
                <li>
                    <a href="{{ url_for('view_forum', forum_id=forum_id) }}">
                        {{ forum['name'] }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <section class="forum-list card">
        <h2 class="red-title">–¢–µ–º–∏</h2>
        <h3 class="subtitle_s">—Ç—É—Ç —Å–æ—Ç–Ω—ñ —Ç–∏—Å—è—á –º–∞–ª–µ–Ω—å–∫–∏—Ö —Å–≤—ñ—Ç—ñ–≤ —è–∫—ñ —Ö–æ—á—É—Ç—å, —â–æ–± –≤–∏ —ó—Ö –¥–æ—Å–ª—ñ–¥–∏–ª–∏...</h3>
        <ul>
            {% for forum_id, forum in forums %}
            <li class="post">
                <div class="post-content">
                    <h3>{{ forum['name'] }}</h3>
                    <h4 class="live">{% if forum.is_live %}/ –í –µ—Ç–µ—Ä—ñ {% endif %}</h4>
                    <h4 class="subtitle_s">–ø—ñ–¥–ø–∏—Å–Ω–∏–∫–∏: {{ get_subscriber_count(forum_id) }}</h4>
                    <h5 class="subtitle">–†–µ–ø: {{ forum['reputation'] }}</h5>
                    <p>{{ forum['description'[:50]] | safe }}</p>
                    <div class="author">
                         –ê–≤—Ç–æ—Ä:
                    {% set author = users.get(forum['author_id']) %}
                    {% if author %}
                        <a href="{{ url_for('view_user_profile', uid=forum['author_id']) }}">
                    {{ author['username'] }}
                    </a>
                    {% else %}
                        ???
                    {% endif %}
                    </div>

                    <a href="{{ url_for('view_forum', forum_id=forum_id) }}">üîç –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</a>
                </div>

                {% if show_menu == forum_id %}
                <div class="admin-menu">
                    {% if session['user_id'] == forum['author_id'] or 'admin' in session.get('roles', []) %}
                        <form action="{{ url_for('delete_forum', forum_id=forum_id) }}" method="POST" onsubmit="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é —Ç–µ–º—É?')">
                            <button type="submit" class="delete-btn">–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–µ–º—É</button>
                        </form>
                        <form action="{{ url_for('edit_forum', forum_id=forum_id) }}" method="GET">
                            <button type="submit">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                        </form>
                    {% endif %}
                </div>
                {% endif %}

                <div class="votes">
                    <form action="{{ url_for('vote_forum', forum_id=forum_id) }}" method="POST">
                        {% if session['user_id'] not in forum['votes'] %}
                            <button type="submit" name="vote" value="up">‚¨ÜÔ∏è</button>
                            <span>{{ forum['vote_count'] }}</span>
                            <button type="submit" name="vote" value="down">‚¨áÔ∏è</button>
                        {% else %}
                            <button type="submit" name="vote" value="cancel">‚ùå</button>
                        {% endif %}
                    </form>
                </div>

                {% if 'user_id' in session %}
                    {% if session['user_id'] not in forum['subscribers'] %}
                        <form action="{{ url_for('subscribe_forum', forum_id=forum_id) }}" method="POST">
                            <button type="submit">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è</button>
                        </form>
                    {% else %}
                        <form action="{{ url_for('unsubscribe_forum', forum_id=forum_id) }}" method="POST">
                            <button type="submit">–í—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è</button>
                        </form>
                    {% endif %}
                    {% if session['user_id'] == forum['author_id'] %}
                        <form action="{{ url_for('moderate_forum', forum_id=forum_id) }}" method="GET">
                            <button type="submit">–∫–µ—Ä—É–≤–∞—Ç–∏</button>
                        </form>
                    {% endif %}
                {% else %}
                    <p>–î–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ <a href="{{ url_for('login') }}">—É–≤—ñ–π—Ç–∏</a>.</p>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </section>
</main>
<script>
  setInterval(() => {
    fetch(location.href, { headers: { "X-Requested-With": "XMLHttpRequest" } })
      .then(res => res.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");

        const newList = doc.querySelector('.forum-list');
        const oldList = document.querySelector('.forum-list');
        if (newList && oldList) {
          oldList.innerHTML = newList.innerHTML;
        }

        const newLiveSidebar = doc.querySelector('.live-forums ul');
        const oldLiveSidebar = document.querySelector('.live-forums ul');
        if (newLiveSidebar && oldLiveSidebar) {
          oldLiveSidebar.innerHTML = newLiveSidebar.innerHTML;
        }
      })
      .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:", err));
  }, 30000); 
</script>


<footer>
    <p>2025 NTTV ‚Äî –†–∞–∑–æ–º —Ç–≤–æ—Ä–∏–º–æ —Å—Ç–∏–ª—å–Ω—É —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å</p>
</footer>
</body>
</html>
